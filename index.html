<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8" />
<title>InTouch Collective — Journey</title>
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<meta name="description" content="Kameralne spotkania offline w Warszawie. Zacznij od oddechu 4x7x8, refleksji i buduj autentyczne relacje.">
<link href="https://fonts.googleapis.com/css2?family=Recursive:opsz,wght@500;700&family=Plus+Jakarta+Sans:wght@400;600&display=swap" rel="stylesheet">
<style>
  :root {
    --earth:#f0e7dc;
    --sky:#dce9fb;
    --accent:#c25e32;
    --bg-start:#dce9fb;
    --bg-end:#f0ebe2;
    --text:#1f242c;
    --transition:.38s cubic-bezier(.23,.13,.35,1);
    --shadow:0 40px 140px -10px rgba(31,36,44,.18);
    --font-head:'Recursive', system-ui,-apple-system,BlinkMacSystemFont,sans-serif;
    --font-body:'Plus Jakarta Sans', system-ui,-apple-system,BlinkMacSystemFont,sans-serif;
  }
  *{box-sizing:border-box;}
  body{
    margin:0;
    background: linear-gradient(135deg,var(--bg-start) 0%,var(--bg-end) 90%);
    font-family: var(--font-body);
    color: var(--text);
    -webkit-font-smoothing:antialiased;
    overflow-x:hidden;
    min-height:100vh;
    scroll-behavior:smooth;
    transition: background 0.8s ease-out;
  }
  h1{margin:0;font-family:var(--font-head);font-size:2.4rem;line-height:1.05;}
  h2{margin:0 0 6px;font-family:var(--font-head);font-size:1.5rem;line-height:1.1;}
  p{margin:8px 0 16px;font-size:1rem;}
  small{font-size:.65em;color:rgba(31,36,44,.6);}
  button{cursor:pointer;border:none;}
  .wrap{width:100%;max-width:960px;margin:0 auto;display:flex;flex-direction:column;gap:48px;padding:0 14px;}
  .pager{position:fixed;left:0;right:0;bottom:8px;display:flex;justify-content:center;gap:16px;z-index:50;pointer-events:auto;padding:0 8px;}
  .node{position:relative;width:16px;height:16px;border-radius:50%;background:rgba(255,255,255,.85);border:2px solid rgba(31,36,44,.15);display:flex;align-items:center;justify-content:center;font-size:10px;font-weight:600;transition:all .3s;cursor:pointer;}
  .node.active{background:var(--accent);border-color:var(--accent);box-shadow:0 0 16px rgba(194,94,50,.6);color:#fff;}
  .path-svg{position:fixed;left:10%;right:10%;bottom:42px;height:60px;pointer-events:none;z-index:10;}
  .card{background:rgba(255,253,248,.95);border-radius:24px;padding:28px 26px;box-shadow:var(--shadow);position:relative;display:flex;flex-wrap:wrap;gap:24px;overflow:hidden;transition:transform .25s;}
  .card:hover{transform:translateY(-2px);}
  .badge{display:inline-block;background:var(--accent);color:#fff;padding:6px 14px;border-radius:999px;font-size:.65em;font-weight:600;margin-bottom:6px;letter-spacing:0.5px;}
  .underline{position:relative;display:inline-block;margin-bottom:6px;}
  .underline:after{content:'';position:absolute;left:0;bottom:0;height:8px;width:100%;background:rgba(194,94,50,.22);border-radius:4px;}
  .input{padding:14px 16px;border-radius:999px;border:2px solid rgba(31,36,44,.1);font-size:1rem;flex:1;min-width:140px;outline:none;transition:box-shadow .25s;}
  .btn{padding:14px 22px;border-radius:999px;cursor:pointer;font-weight:600;display:inline-flex;align-items:center;gap:10px;transition:all var(--transition);position:relative;font-family:var(--font-body);}
  .btn-primary{background: linear-gradient(135deg,var(--accent),#3f86c9);color:#fff;box-shadow:0 18px 80px -10px rgba(194,94,50,.45);}
  .btn-secondary{background:#fff;border:2px solid var(--accent);color:var(--accent);}
  .breath-panel{position:relative;display:flex;flex-wrap:wrap;gap:24px;background:#fffefb;border-radius:24px;padding:32px;box-shadow:0 60px 160px -30px rgba(31,36,44,.18);}
  .breath-visual{flex:1;min-width:220px;display:flex;flex-direction:column;gap:14px;align-items:center;justify-content:center;position:relative;}
  .circle{width:180px;height:180px;border-radius:50%;display:flex;align-items:center;justify-content:center;position:relative;overflow:hidden;background:rgba(194,94,50,.08);transition:transform .3s;cursor:pointer;}
  .circle-inner{width:130px;height:130px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:1rem;font-weight:700;color:#fff;position:relative;transition:transform .4s;background:var(--accent);flex-direction:column;display:flex;gap:4px;}
  .progress{margin-top:6px;display:flex;gap:6px;justify-content:center;}
  .dot{width:16px;height:16px;border-radius:50%;background:#e0d8ce;position:relative;box-shadow:inset 0 2px 6px rgba(31,36,44,.1);}
  .dot.active{background:var(--accent);box-shadow:0 0 16px rgba(194,94,50,.7);}
  .breath-info{flex:1;min-width:260px;display:flex;flex-direction:column;gap:14px;justify-content:center;position:relative;}
  .verbal{font-size:1.2rem;font-weight:600;}
  .explore-hint{position:absolute;bottom:12px;left:50%;transform:translateX(-50%);background:rgba(255,255,255,.95);padding:10px 16px;border-radius:999px;display:flex;align-items:center;gap:6px;font-size:.85em;box-shadow:0 20px 80px -10px rgba(31,36,44,.1);animation:wiggle 3s infinite ease-in-out;z-index:2;}
  @keyframes wiggle{0%{transform:translate(-50%,0) rotate(0deg);}30%{transform:translate(-50%,2px) rotate(-1deg);}60%{transform:translate(-50%,-1px) rotate(1deg);}100%{transform:translate(-50%,0) rotate(0deg);}}
  .reflection{display:flex;gap:20px;flex-wrap:wrap;}
  .reflection-options{display:flex;gap:14px;flex-wrap:wrap;margin-top:6px;}
  .reflection-btn{padding:12px 16px;border-radius:14px;border:2px solid rgba(31,36,44,.15);background:#fff;cursor:pointer;transition:all .3s;font-weight:600;display:inline-flex;gap:8px;}
  .reflection-btn.active{border-color:var(--accent);background:rgba(194,94,50,.07);}
  .slicer-combined{display:flex;gap:20px;flex-wrap:wrap;margin-top:14px;}
  .rhythm-box{flex:1;min-width:260px;background:rgba(255,255,255,.95);padding:20px;border-radius:18px;box-shadow:0 30px 120px -20px rgba(31,36,44,.12);position:relative;display:flex;flex-direction:column;gap:12px;}
  .rhythm-slider{width:100%;height:14px;border-radius:8px;appearance:none;background:linear-gradient(90deg,#5b7a59 0%,#3f86c9 50%,#f5c158 100%);outline:none;position:relative;}
  .rhythm-slider::-webkit-slider-thumb{appearance:none;width:24px;height:24px;border-radius:50%;background:var(--accent);border:3px solid #fff;box-shadow:0 0 25px rgba(194,94,50,.5);cursor:pointer;transition:transform .2s;}
  .rhythm-labels{display:flex;justify-content:space-between;margin-top:6px;font-weight:600;}
  .event-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:18px;margin-top:20px;}
  .event{position:relative;background:rgba(255,253,248,.95);border-radius:16px;padding:18px;clip-path:polygon(3% 0,100% 4%,100% 96%,0 100%);box-shadow:0 38px 160px -15px rgba(31,36,44,.12);display:flex;flex-direction:column;gap:8px;transition:transform .35s,box-shadow .35s;}
  .event:hover{transform:translateY(-3px);box-shadow:0 50px 180px -5px rgba(31,36,44,.18);}
  .event .tag{font-size:.55em;background:rgba(194,94,50,.12);padding:4px 12px;border-radius:999px;display:inline-block;margin-bottom:6px;letter-spacing:0.5px;}
  .event-title{font-weight:700;font-size:1.1rem;margin:4px 0;}
  .event-meta{font-size:.65em;color:rgba(31,36,44,.65);}
  .email-block{background:rgba(255,255,255,.97);border-radius:20px;padding:20px;display:flex;flex-wrap:wrap;gap:18px;box-shadow:0 50px 160px -30px rgba(31,36,44,.12);}
  .email-left{flex:2;min-width:200px;}
  .email-right{flex:1;min-width:160px;display:flex;flex-direction:column;gap:12px;}
  .rodo{font-size:.65em;color:rgba(31,36,44,.6);margin-top:4px;font-style:italic;}
  .final{display:flex;gap:24px;flex-wrap:wrap;margin-top:4px;}
  .cta-box{flex:1;min-width:220px;background:rgba(255,255,248,.95);border-radius:20px;padding:18px;box-shadow:var(--shadow);display:flex;flex-direction:column;gap:12px;}
  .hidden{display:none!important;}
  @media (max-width:960px){
    h1{font-size:2rem;}
    .breath-panel{flex-direction:column;}
    .reflection{flex-direction:column;}
    .final{flex-direction:column;}
    .slicer-combined{flex-direction:column;}
    .pager{gap:8px;}
  }
</style>
</head>
<body>

  <!-- pager + path (preserved) -->
  <div class="pager" aria-label="Progress path">
    <div class="node" data-target="screen-breath">1</div>
    <div class="node" data-target="screen-about">2</div>
    <div class="node" data-target="screen-reflect">3</div>
    <div class="node" data-target="screen-why">4</div>
    <div class="node" data-target="screen-slicer-events">5</div>
    <div class="node" data-target="screen-signup">6</div>
    <div class="node" data-target="screen-final">7</div>
  </div>
  <svg class="path-svg" aria-hidden="true">
    <path d="M10 40 C30 0,70 80,90 40 S170 40,190 40" stroke="rgba(31,36,44,.1)" stroke-width="6" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
  </svg>

  <div class="wrap">
    <!-- 1. Breathing Game full start -->
    <section id="screen-breath">
      <div class="card">
        <div class="breath-panel" style="width:100%;max-width:960px;position:relative;">
          <div class="breath-visual">
            <div class="badge">1. Oddech 4x7x8</div>
            <div class="underline"><h2>Rytuał obecności</h2></div>
            <div class="circle" id="circleControl" aria-label="Visual breath">
              <div class="circle-inner" id="circleInner">
                <div id="phaseLabel" style="font-size:.8em;">Start</div>
                <div id="timerLabel" style="font-size:1.3rem;">—</div>
                <div style="font-size:.55em;">Cykle: <span id="cycleCount">0/3</span></div>
              </div>
            </div>
            <div class="progress" aria-label="Cycle progress">
              <div class="dot" data-cycle="1"></div>
              <div class="dot" data-cycle="2"></div>
              <div class="dot" data-cycle="3"></div>
            </div>
            <div style="margin-top:6px;">
              <div class="verbal" id="verbalText">Gotowy</div>
              <div><small id="cycleLabel">0 / 3</small></div>
            </div>
          </div>
          <div class="breath-info">
            <p>Weź 3 cykle: wdech 4s, wstrzymanie 7s, wydech 8s. Ustaw intencję, uspokój umysł. Nawet jeśli przewiniesz dalej, rytm zostaje, a rekomendacje dostaniesz poniżej.</p>
            <div style="display:flex;gap:16px;flex-wrap:wrap;align-items:center;">
              <button class="btn btn-primary" id="startBreathBtn">Rozpocznij</button>
              <button class="btn btn-secondary" id="toggleSound">Dźwięk: ON</button>
            </div>
            <div><small>Po zakończeniu zobaczysz dopasowanie sesji i sugestię głębi/tempa.</small></div>
          </div>
          <div class="explore-hint" id="exploreHint"><span style="display:inline-block;transform:rotate(45deg);border-left:3px solid var(--accent);border-bottom:3px solid var(--accent);width:12px;height:12px;margin-right:6px;"></span>Przewiń, żeby zobaczyć resztę drogi</div>
        </div>
      </div>
    </section>

    <!-- 2. About us -->
    <section id="screen-about">
      <div class="card">
        <div style="flex:1;min-width:260px;">
          <div class="badge">2. Kim jesteśmy</div>
          <div class="underline"><h1>InTouch Collective</h1></div>
          <p>Dwóch przyjaciół z psychologicznym zacięciem organizuje kameralne spotkania offline w Warszawie. Tworzymy struktury — gry, rytuały i facylitację — które pozwalają ludziom łączyć się autentycznie zamiast przypadkowo. Nasze sesje dają przestrzeń do refleksji i relacji bez presji.</p>
        </div>
        <div style="flex:1;min-width:260px;">
          <div class="badge">Co robimy</div>
          <div class="underline"><h1>Dlaczego to działa</h1></div>
          <p>Łączymy autorskie gry, świadome rozmowy i facylitację w bezpiecznej, uważnej przestrzeni. Uczestnicy nie tylko poznają ludzi — przechodzą przez system doświadczeń prowadzących do prawdziwego połączenia.</p>
          <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:8px;">
            <div class="badge" style="background:rgba(59,44,36,.15);color:var(--text);">Autentyczność</div>
            <div class="badge" style="background:rgba(59,44,36,.15);color:var(--text);">Uważność</div>
            <div class="badge" style="background:rgba(59,44,36,.15);color:var(--text);">Psychologia grupowa</div>
          </div>
        </div>
      </div>
    </section>

    <!-- 3. Reflection question -->
    <section id="screen-reflect">
      <div class="card">
        <div style="flex:1;min-width:260px;">
          <div class="badge">3. Mała refleksja</div>
          <div class="underline"><h2>Co Cię zatrzymuje?</h2></div>
          <p>Patrząc na relacje z własnej perspektywy: co podcina głębię? Wybierz jedną i zobacz sugestię następnego kroku.</p>
          <div class="reflection-options">
            <button class="reflection-btn" data-key="superficial">Wszystko wydaje się płytkie</button>
            <button class="reflection-btn" data-key="distance">Czuję dystans</button>
            <button class="reflection-btn" data-key="fear">Boję się zacząć</button>
          </div>
          <div id="reflectionResult" style="margin-top:14px;font-weight:600;"></div>
          <small>To Twoja mapa ruchu. Nie zapisujemy tego.</small>
        </div>
        <div style="flex:none;min-width:120px;display:flex;align-items:center;justify-content:center;">
          <div class="slicer-icon" id="reflectIcon">🤔</div>
        </div>
      </div>
    </section>

    <!-- 4. Why us -->
    <section id="screen-why">
      <div class="card">
        <div style="flex:1;min-width:260px;">
          <div class="badge">4. Dlaczego my?</div>
          <div class="underline"><h2>Co nas wyróżnia</h2></div>
          <p>Nie robimy kolejnej „integracji”. Projektujemy doświadczenia z rytuałami wejścia, autorskimi ćwiczeniami i adaptacyjną facylitacją, by relacje rozwijały się naturalnie. Każda sesja jest dopasowana do energii grupy i tempa uczestników.</p>
          <ul style="padding-left:18px;margin:8px 0;">
            <li>Małe, uważne grupy</li>
            <li>Autorskie, starannie dopasowane gry</li>
            <li>Rytuały obecności i refleksji</li>
            <li>Adaptacyjne prowadzenie</li>
          </ul>
        </div>
        <div style="flex:1;min-width:260px;">
          <div class="underline"><h2>Dla kogo</h2></div>
          <p>Dla tych, którzy są zmęczeni szybkim online i chcą zbudować relacje z sensem — bez presji, krok po kroku.</p>
          <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:6px;">
            <div class="badge" style="background:rgba(59,44,36,.15);color:var(--text);">Autentyczność</div>
            <div class="badge" style="background:rgba(59,44,36,.15);color:var(--text);">Bezpieczeństwo</div>
            <div class="badge" style="background:rgba(59,44,36,.15);color:var(--text);">Wspólne doświadczenie</div>
          </div>
          <div style="margin-top:8px;"><strong>Efekt:</strong> Przełamanie izolacji, relacje, większa samoświadomość.</div>
        </div>
      </div>
    </section>

    <!-- 5. Combined rhythm + notify + events -->
    <section id="screen-slicer-events">
      <div class="card">
        <div style="display:flex;flex-wrap:wrap;gap:28px;">
          <!-- top row: rhythm (speed×depth) and notify -->
          <div style="flex:2;min-width:300px;display:flex;gap:20px;flex-wrap:wrap;">
            <div class="rhythm-box" style="flex:1;">
              <div class="badge">5. Twój rytm</div>
              <div class="underline"><h2>Wybierz swój rytm (speed × depth)</h2></div>
              <p>Twoje ustawienie łączy tempo i głębię. Im bliżej skrajów, tym bardziej dopasowana sesja — zobacz rekomendacje poniżej.</p>
              <div>
                <input type="range" id="rhythmSlider" class="rhythm-slider" min="0" max="100" value="50" aria-label="Rytm"/>
                <div class="rhythm-labels">
                  <div>Tempo ⚡</div>
                  <div>Zrównoważone</div>
                  <div>Głębia 🌳</div>
                </div>
                <div style="margin-top:6px;font-weight:600;">Aktualnie: <span id="rhythmLabel">Zrównoważone</span></div>
              </div>
              <div style="margin-top:8px;font-size:.85em;">Wybór wpływa na to, które wydarzenia są podkreślone.</div>
            </div>
            <div class="rhythm-box" style="flex:1;min-width:260px;">
              <div class="badge">Nie przegap</div>
              <div class="underline"><h2>Powiadom mnie</h2></div>
              <p>Zostaw email — przypomnimy o nowych sesjach, dasz sobie priorytetowy dostęp i dostaniesz krótkie refleksje.</p>
              <div style="display:flex;gap:14px;flex-wrap:wrap;align-items:center;">
                <input type="email" id="notifyEmail" class="input" placeholder="Twój email" aria-label="Email powiadomień" />
                <button class="btn btn-primary" id="notifyBtn">Powiadom mnie</button>
              </div>
              <div class="rodo">RODO: bez sprzedaży danych. Możesz zrezygnować.</div>
            </div>
          </div>
        </div>
        <!-- bottom: events -->
        <div style="margin-top:24px;">
          <div class="badge">Sesje</div>
          <div class="underline"><h2>Nadchodzące wydarzenia</h2></div>
          <p>Po oddechu, refleksji i ustawieniu rytmu — wybierz sesję dopasowaną do Ciebie. Sugerujemy na podstawie Twojego wyboru.</p>
          <div class="event-grid" id="events">
            <div class="event" data-reco="deep">
              <div class="tag">5 sierpnia</div>
              <div class="event-title">Prawdziwe rozmowy</div>
              <div class="event-meta">Warszawa · limit 12</div>
              <p>Małe grupy, uważne ćwiczenia, naturalne połączenia.</p>
              <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap;">
                <button class="btn btn-primary open-signup" data-event="Prawdziwe rozmowy">Zapisz się</button>
                <div style="font-size:.7em;">Rekomendacja: głębia</div>
              </div>
            </div>
            <div class="event" data-reco="balanced">
              <div class="tag">12 sierpnia</div>
              <div class="event-title">Głębia i tempo</div>
              <div class="event-meta">Warszawa · limit 18</div>
              <p>Balans między szybkim startem a relacją z sensem.</p>
              <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap;">
                <button class="btn btn-primary open-signup" data-event="Głębia i tempo">Zapisz się</button>
                <div style="font-size:.7em;">Hybrydowo</div>
              </div>
            </div>
            <div class="event" data-reco="tempo">
              <div class="tag">19 sierpnia</div>
              <div class="event-title">Mikro-spotkania</div>
              <div class="event-meta">Warszawa · limit 20</div>
              <p>Szybki start i kontynuacja — poznaj kilku nowych ludzi.</p>
              <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap;">
                <button class="btn btn-primary open-signup" data-event="Mikro-spotkania">Zapisz się</button>
                <div style="font-size:.7em;">Tempo + jakość</div>
              </div>
            </div>
            <div class="event" data-reco="deep">
              <div class="tag">2 września</div>
              <div class="event-title">Retreat: Autentyczna obecność</div>
              <div class="event-meta">Warszawa · limit 10</div>
              <p>Cały dzień offline: refleksja, relacje, obecność.</p>
              <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap;">
                <button class="btn btn-primary open-signup" data-event="Retreat">Zapisz się</button>
                <div style="font-size:.7em;">Tempo przemyślane</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- 6. Email + Event signup -->
    <section id="screen-signup">
      <div class="card">
        <div style="display:flex;gap:32px;flex-wrap:wrap;">
          <div style="flex:1;min-width:260px;">
            <div class="underline"><h2>Zostaw email</h2></div>
            <p>Chcesz być informowany? Daj znać — dostaniesz przypomnienia, priorytetowy dostęp i krótkie follow-upy.</p>
            <div style="display:flex;gap:14px;flex-wrap:wrap;align-items:center;">
              <input type="email" id="captureEmail" class="input" placeholder="Twój email" aria-label="Email" />
              <button class="btn btn-primary" id="captureBtn">Zapisz się</button>
            </div>
            <div class="rodo">RODO: tylko powiadomienia, bez sprzedaży danych.</div>
          </div>
          <div style="flex:1;min-width:260px;" id="eventSignup">
            <div class="badge" id="selectedEventTag">Zapisz się</div>
            <div class="underline"><h2 id="selectedEventTitle">Wybierz wydarzenie</h2></div>
            <p id="selectedEventDesc">Podaj email i telefon, potwierdź zgodę RODO — potwierdzimy miejsce i przypomnimy.</p>
            <div style="display:flex;gap:14px;flex-wrap:wrap;align-items:center;">
              <input type="email" id="eventEmail" class="input" placeholder="Email" aria-label="Email wydarzenia" />
              <input type="tel" id="eventPhone" class="input" placeholder="Telefon" aria-label="Telefon" style="max-width:160px;" />
            </div>
            <div style="margin-top:10px;">
              <label style="display:flex;gap:8px;align-items:center;"><input type="checkbox" id="consentEvent" /> Akceptuję przetwarzanie danych zgodnie z RODO.</label>
            </div>
            <div style="margin-top:14px;">
              <button class="btn btn-primary" id="submitEvent">Dołącz</button>
            </div>
            <div id="signupFeedback" style="margin-top:8px;font-weight:600;"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- Final summary -->
    <section id="screen-final">
      <div class="card">
        <div class="final">
          <div class="cta-box">
            <div class="underline"><h2>Zostań w kontakcie</h2></div>
            <p>Otrzymuj przypomnienia, refleksje i zaproszenia. Dostosujemy rytm do Ciebie.</p>
            <div style="display:flex;gap:14px;flex-wrap:wrap;align-items:center;">
              <input type="email" id="finalEmail" class="input" placeholder="Twój email" aria-label="Email końcowy" />
              <button class="btn btn-primary" id="finalSign">Zapisz</button>
            </div>
            <div class="rodo">RODO: tylko to, na co się zgadzasz.</div>
          </div>
          <div class="cta-box">
            <div class="badge">W skrócie</div>
            <div class="underline"><h2>Dlaczego warto</h2></div>
            <ul style="padding-left:18px;margin:6px 0;">
              <li>Kameralne sesje w Warszawie</li>
              <li>Facylitacja oparta na psychologii</li>
              <li>Rytuały obecności + refleksja</li>
              <li>Autentyczne relacje</li>
            </ul>
          </div>
        </div>
      </div>
    </section>

  </div>

  <script>
    // Scroll-linked pager (unchanged)
    const nodes = Array.from(document.querySelectorAll('.node'));
    const sections = [
      document.getElementById('screen-breath'),
      document.getElementById('screen-about'),
      document.getElementById('screen-reflect'),
      document.getElementById('screen-why'),
      document.getElementById('screen-slicer-events'),
      document.getElementById('screen-signup'),
      document.getElementById('screen-final')
    ];
    function updateActiveNode(){
      const scrollPos = window.scrollY + window.innerHeight/3;
      sections.forEach((sec,i)=>{
        const top = sec.offsetTop;
        if(scrollPos >= top){
          nodes.forEach(n=>n.classList.remove('active'));
          if(nodes[i]) nodes[i].classList.add('active');
        }
      });
    }
    window.addEventListener('scroll', updateActiveNode);
    nodes.forEach((n,idx)=>{
      n.addEventListener('click', ()=>{
        sections[idx].scrollIntoView({behavior:'smooth', block:'start'});
      });
    });
    updateActiveNode();

    // Breathing 4x7x8 logic with start/stop toggle, timer inside circle, dynamic background
    const startBtn = document.getElementById('startBreathBtn');
    const verbalText = document.getElementById('verbalText');
    const circle = document.getElementById('circleControl');
    const circleInner = document.getElementById('circleInner');
    const phaseLabel = document.getElementById('phaseLabel');
    const timerLabel = document.getElementById('timerLabel');
    const cycleCount = document.getElementById('cycleCount');
    const progressDots = Array.from(document.querySelectorAll('.dot'));
    const cycleLabelText = document.getElementById('cycleLabel');
    const exploreHint = document.getElementById('exploreHint');
    const toggleSoundBtn = document.getElementById('toggleSound');
    let soundOn = true;
    let breathingActive = false;
    let abortController = {stop:false};
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    function playTone(freq,dur){
      if(!soundOn) return;
      const osc = audioCtx.createOscillator();
      const gain = audioCtx.createGain();
      osc.type='sine'; osc.frequency.value=freq;
      osc.connect(gain); gain.connect(audioCtx.destination);
      gain.gain.setValueAtTime(0, audioCtx.currentTime);
      gain.gain.linearRampToValueAtTime(0.08, audioCtx.currentTime + 0.02);
      osc.start();
      gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + dur);
      setTimeout(()=>osc.stop(), dur*1000 + 50);
    }
    function interpolate(a,b,t){
      const ah=parseInt(a.slice(1),16), bh=parseInt(b.slice(1),16);
      const ar=ah>>16, ag=(ah>>8)&255, ab=ah&255;
      const br=bh>>16, bg=(bh>>8)&255, bb=bh&255;
      const rr=Math.round(ar + (br-ar)*t).toString(16).padStart(2,'0');
      const rg=Math.round(ag + (bg-ag)*t).toString(16).padStart(2,'0');
      const rb=Math.round(ab + (bb-ab)*t).toString(16).padStart(2,'0');
      return `#${rr}${rg}${rb}`;
    }
    function setBackground(phase,progress){
      let gradient;
      if(phase==='inhale'){
        gradient = `linear-gradient(135deg, ${interpolate('#dce9fb','#ffffff', progress)} 0%, ${interpolate('#f0ebe2','#ffffff', progress)} 85%)`;
      } else if(phase==='hold'){
        gradient = `linear-gradient(135deg, ${interpolate('#ffffff','#f0ebe2', progress)} 0%, ${interpolate('#ffffff','#e6ddcf', progress)} 85%)`;
      } else { // exhale
        gradient = `linear-gradient(135deg, ${interpolate('#f0ebe2','#e6ddcf', progress)} 0%, ${interpolate('#efe7dd','#e6ddcf', progress)} 85%)`;
      }
      document.body.style.background = gradient;
    }
    async function runBreathing(){
      breathingActive = true;
      startBtn.textContent='Stop';
      phaseLabel.textContent='Wdech';
      verbalText.textContent='Wdech';
      let cycles=0;
      cycleLabelText.textContent = `0 / 3`;
      cycleCount.textContent = `0/3`;
      progressDots.forEach(d=>d.classList.remove('active'));
      abortController.stop=false;
      for(; cycles<3; ){
        // inhale 4s
        let remaining=4;
        phaseLabel.textContent='Wdech';
        verbalText.textContent='Wdech';
        circleInner.style.transform='scale(1.2)';
        if(soundOn) playTone(260,4);
        while(remaining>0){
          if(abortController.stop) return resetBreathing();
          timerLabel.textContent=remaining;
          setBackground('inhale', (4-remaining)/4);
          await new Promise(r=>setTimeout(r,1000));
          remaining--;
        }
        // hold 7s
        remaining=7;
        phaseLabel.textContent='Wstrzymaj';
        verbalText.textContent='Wstrzymaj';
        circleInner.style.transform='scale(1)';
        if(soundOn) playTone(320,0.2);
        while(remaining>0){
          if(abortController.stop) return resetBreathing();
          timerLabel.textContent=remaining;
          setBackground('hold', (7-remaining)/7);
          await new Promise(r=>setTimeout(r,1000));
          remaining--;
        }
        // exhale 8s
        remaining=8;
        phaseLabel.textContent='Wydech';
        verbalText.textContent='Wydech';
        circleInner.style.transform='scale(.85)';
        if(soundOn) playTone(180,8);
        while(remaining>0){
          if(abortController.stop) return resetBreathing();
          timerLabel.textContent=remaining;
          setBackground('exhale', (8-remaining)/8);
          await new Promise(r=>setTimeout(r,1000));
          remaining--;
        }
        cycles++;
        cycleLabelText.textContent = `${cycles} / 3`;
        cycleCount.textContent = `${cycles}/3`;
        progressDots.forEach(d=>{
          const idx = Number(d.dataset.cycle);
          d.classList.toggle('active', idx <= cycles);
        });
      }
      phaseLabel.textContent='Gotowe';
      verbalText.textContent='✓';
      timerLabel.textContent='✓';
      circleInner.style.transform='scale(1)';
      startBtn.textContent='Rozpocznij';
      breathingActive=false;
      setTimeout(()=>{ exploreHint.style.opacity='0'; }, 600);
    }
    function resetBreathing(){
      breathingActive=false;
      startBtn.textContent='Rozpocznij';
      phaseLabel.textContent='Start';
      verbalText.textContent='Gotowy';
      timerLabel.textContent='—';
      cycleLabelText.textContent='0 / 3';
      cycleCount.textContent='0/3';
      progressDots.forEach(d=>d.classList.remove('active'));
      document.body.style.background = `linear-gradient(135deg,var(--bg-start) 0%,var(--bg-end) 90%)`;
    }
    startBtn.addEventListener('click', ()=>{
      if(breathingActive){
        abortController.stop=true;
      } else {
        runBreathing();
      }
    });
    circle.addEventListener('click',(e)=>{
      if(breathingActive){
        abortController.stop=true;
      } else {
        runBreathing();
      }
    });
    toggleSoundBtn.addEventListener('click', ()=>{
      soundOn=!soundOn;
      toggleSoundBtn.textContent = `Dźwięk: ${soundOn? 'ON':'OFF'}`;
    });

    // Reflection buttons (unchanged)
    document.querySelectorAll('.reflection-btn').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        document.querySelectorAll('.reflection-btn').forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        const key=btn.dataset.key;
        const output=document.getElementById('reflectionResult');
        if(key==='superficial'){
          output.textContent='Czujesz, że relacje zostają na powierzchni — spróbuj jednej szczerej rozmowy zamiast wielu przypadkowych.';
          document.getElementById('reflectIcon').textContent='🤏';
        } else if(key==='distance'){
          output.textContent='Dystans? Zaproś jedną osobę na krótki kontakt bez oczekiwań.';
          document.getElementById('reflectIcon').textContent='↔️';
        } else if(key==='fear'){
          output.textContent='Strach? Zacznij od obecności: bądź obok, potem zapytaj „Co u Ciebie?”.';
          document.getElementById('reflectIcon').textContent='🛡️';
        }
      });
    });

    // Rhythm slider logic + event highlighting
    const rhythmSlider = document.getElementById('rhythmSlider');
    const rhythmLabel = document.getElementById('rhythmLabel');
    rhythmSlider.addEventListener('input', ()=>{
      const v = Number(rhythmSlider.value)/100;
      if(v < 0.35) rhythmLabel.textContent='Tempo';
      else if(v > 0.65) rhythmLabel.textContent='Głębia';
      else rhythmLabel.textContent='Zrównoważone';
      document.querySelectorAll('.event').forEach(ev=>{
        const reco = ev.dataset.reco;
        ev.style.opacity='1';
        if(v < 0.35){
          if(reco==='deep') ev.style.opacity='0.5';
        } else if(v > 0.65){
          if(reco==='tempo') ev.style.opacity='0.5';
        }
      });
    });

    // Email/signup flows
    document.getElementById('notifyBtn')?.addEventListener('click', ()=>{
      const e=document.getElementById('notifyEmail').value.trim();
      if(!e.includes('@')){ alert('Podaj poprawny email'); return;}
      document.getElementById('notifyBtn').textContent='✅ Dziękujemy';
    });
    document.getElementById('captureBtn')?.addEventListener('click', ()=>{
      const e=document.getElementById('captureEmail').value.trim();
      if(!e.includes('@')){ alert('Podaj poprawny email'); return;}
      document.getElementById('captureBtn').textContent='OK ✓';
    });
    let selectedEvent='';
    document.querySelectorAll('.open-signup').forEach(b=>{
      b.addEventListener('click', ()=>{
        selectedEvent = b.dataset.event;
        document.getElementById('selectedEventTitle').textContent=selectedEvent;
        document.getElementById('selectedEventTag').textContent='Zapisz się: ' + selectedEvent;
        document.getElementById('selectedEventDesc').textContent='Podaj email i telefon, potwierdź RODO – potwierdzimy miejsce.';
        document.getElementById('screen-signup')?.scrollIntoView({behavior:'smooth'});
      });
    });
    document.getElementById('submitEvent')?.addEventListener('click', ()=>{
      const email=document.getElementById('eventEmail').value.trim();
      const phone=document.getElementById('eventPhone').value.trim();
      const consent=document.getElementById('consentEvent').checked;
      const feedback=document.getElementById('signupFeedback');
      if(!email.includes('@')||!phone){ feedback.textContent='Uzupełnij email i telefon.'; return; }
      if(!consent){ feedback.textContent='Zaznacz zgodę RODO.'; return; }
      feedback.textContent=`Zapisane na "${selectedEvent}". Sprawdzimy szczegóły w wiadomości.`; 
      document.getElementById('submitEvent').textContent='✔ Gotowe';
    });
    document.getElementById('finalSign')?.addEventListener('click', ()=>{
      const e=document.getElementById('finalEmail').value.trim();
      if(!e.includes('@')||!e){ alert('Podaj email'); return; }
      document.getElementById('finalSign').textContent='Zapisane ✓';
    });
  </script>
</body>
</html>
